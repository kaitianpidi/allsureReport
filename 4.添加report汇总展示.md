# 报告查看结果的页面，增加汇总信息  
该案例，实现了一个样例。

## 1. myEdit.js 文件中，增加mySummary(myDataE) 方法，用于增加汇总信息。   

```
var sumFalg=0; //mySummary()方法的计数器
/**
 * 功能：在 页面中增加 报告汇总的页面信息。
 * 说明：mySummary()在app.js 的文件中，会被加载 四次。
 * 为避免重复执行，使用变量sumFalg，进行计数判断，在第四加载该方法时，执行方法
 *
 */
function mySummary(myDataE) {
    // alerr(environmentName);
    sumFalg=sumFalg+1;
    // alert(sumFalg);
    if (sumFalg >3) {
        // url_param();
        var summaryReport = "<div>kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk</div>\n\n<p>dddddddddd</p>";

        $(".app").before(summaryReport);
        sumFalg=0; //计数器清零，避免页面刷新，再次调用该方法
    }
}

/**
 * 获取浏览器地址，解析相关参数。可以给报告汇总，赋值
 * 例如： //environmentName=测试环境&jobName=testallure&buildNumber=888
 * 该地址
 */
function url_param() {
    var d_url=document.location.href;
    var uri = d_url.substring(d_url.indexOf("?")+1);

    uri= decodeURIComponent(uri);  //解码
    var params = uri.split("&");
    var environmentName =params[0].substring(params[0].indexOf("=")+1);
    var jobName = params[1].substring(params[1].indexOf("=")+1);
    var buildNumber =params[2].substring(params[2].indexOf("=")+1);
    alert(environmentName + jobName+ buildNumber);
}
```
##  2. 在app.js文件中，增加一个 mySummary(myDataE) 方法的调用。
 ![mySummer](https://github.com/kaitianpidi/allsureReport/blob/gh-pages/reportEdit/mySumme.png)  
 
 ## 3. “查看结果”的 链接的方法中， 增加查看 aller报告的判断。  
   implement.js 文件中 增加内容在 if 语句（66行`71行）中。原来的代码，移到else{}中。  
   ###页面参数传递：（这里使用了从浏览器地址中获取参数， 也可以使用其他方法传递参数）
   window.open中的url ，这里加了参数，然后 通过js 获取浏览器中的地址得到。（myEdit.js文件的 url_param()获取） 
   
   查看结果 页中如何区分原来的报告和allure报告？，需要需求确定，这里写了个固定的jobName来判断，用于演示（实际中，可以增加一个标识的字段）
   
  
 ```
 //点击执行查看结果页面，需要跳转
window.operateEventsTow = {
    'click .btn-primary': function (e, value, row, index) {
        // var jobName=row.jobName;
        // var buildNumber=row.lastBuildNumber;
        // window.open("http://172.18.11.57:8000/test"+jobName+buildNumber+".html");
        var environmentName = row.environmentName;
        var jobName = row.jobName;
        var buildNumber = row.lastBuildNumber;

        if(jobName=="testallure"){  //这里是写了 固定的 jobName，要替换成自己的jobname（只是为了演示，testallure 是我的jobname）
            var url ="/allure2/jobName1/allureReport#suites";  
            url = url+"?environmentName="+environmentName+"&jobName="+jobName+"&buildNumber="+buildNumber;
            window.open(url, "_self");
            mySummary();
        } else {
            //var version=row.versionValue;
            var path = "testResultDownLoadPath";
            var fileName = "test" + jobName + buildNumber + ".html";

            //var url = "/implementCase/showExecutionResults?environmentName=" + environmentName +"&jobName=" + jobName + "&buildNumber=" + buildNumber + "&path=" + path + "&fileName=" + fileName;
            //window.open(url);
            // $("#panel-default").hide();
            // $("#dataTable").bootstrapTable('destroy');
            // $("#returnPreviousPage4").hide();
            // $("#resultShow").show();
            // $("#returnPreviousPage3").show();


            // $("#panel-body1").hide();
            // $("#toolbar4").show();
            // $("#panel-body4").show();


            $("#panel-body1").hide();
            $("#panel-body2").hide();
            $("#panel-body3").hide();
            // $("#dataTable2").bootstrapTable('destroy');
            $("#returnPreviousPage4").hide();
            $("#returnPreviousPage3").show();
            $("#resultShow").show();
            $("#panel-body4").show();

            getInterfaceNameAndJobName();
            getResultData2(environmentName, jobName, buildNumber, path, fileName);
            setSelect2();


            // $("#toolbar").hide();
            // $("#dataTable").bootstrapTable('destroy');
            // iewReportResults(url);
        }

    }
    // ,
    // 'click .bt-selectB': function (e, value, row, index) {
    //     var path="testResultDownLoadPath";
    //     var fileName="test"+row.jobName+row.lastBuildNumber+".html";
    //     var url="/toolManagement/fileDownload?configPath=" + path+"&fileName="+fileName;
    //     window.open(url);
    // }
};
 ```
 

 
 
